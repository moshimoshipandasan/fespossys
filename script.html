<script>
  // ========== å®šæ•°å®šç¾© ==========
  const APP_CONFIG = {
    IMAGE: {
      DEFAULT_ICON: "ğŸ´",
      HEIGHT: 120,
      PLACEHOLDER_COLOR: "#f0f0f0",
      ICON_SIZE: 48,
    },
    STOCK: {
      LOW_THRESHOLD: 10,
      EMPTY: 0,
    },
    UI: {
      MODAL_ANIMATION_DELAY: 0,
      LOADING_TEXT: "èª­ã¿è¾¼ã¿ä¸­...",
      ERROR_COLOR: "#f44336",
      SUCCESS_COLOR: "#4CAF50",
      WARNING_COLOR: "#ff9800",
    },
    PAYMENT: {
      CASH_ROUND_UNIT: 1000,
      METHODS: {
        CASH: "ç¾é‡‘",
        QR: "QR",
      },
    },
  };

  // ========== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ ==========
  const appState = {
    cart: [],
    products: [],
    recognition: null,
    isProcessing: false,
  };

  // ========== ã‚«ãƒ¼ãƒˆç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ==========
  const CartManager = {
    // ã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ 
    add: function (product) {
      const existingItem = appState.cart.find(
        (item) => item["å•†å“ID"] === product["å•†å“ID"],
      );

      if (existingItem) {
        const newQuantity = existingItem["æ•°é‡"] + 1;
        if (newQuantity <= product["ç¾åœ¨åº«"]) {
          existingItem["æ•°é‡"] = newQuantity;
          return { success: true };
        } else {
          return { success: false, message: "åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™" };
        }
      } else {
        appState.cart.push({
          ...product,
          æ•°é‡: 1,
        });
        return { success: true };
      }
    },

    // æ•°é‡ã‚’æ›´æ–°
    updateQuantity: function (index, change) {
      const item = appState.cart[index];
      const product = appState.products.find(
        (p) => p["å•†å“ID"] === item["å•†å“ID"],
      );
      const newQuantity = item["æ•°é‡"] + change;

      if (
        newQuantity >= 1 &&
        newQuantity <= (product ? product["ç¾åœ¨åº«"] : 999)
      ) {
        item["æ•°é‡"] = newQuantity;
        return true;
      }
      return false;
    },

    // ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
    remove: function (index) {
      appState.cart.splice(index, 1);
    },

    // ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
    clear: function () {
      appState.cart = [];
    },

    // åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—
    getTotal: function () {
      return appState.cart.reduce(
        (sum, item) => sum + item["ä¾¡æ ¼"] * item["æ•°é‡"],
        0,
      );
    },

    // ã‚«ãƒ¼ãƒˆãŒç©ºã‹ãƒã‚§ãƒƒã‚¯
    isEmpty: function () {
      return appState.cart.length === 0;
    },
  };

  // ========== åˆæœŸåŒ–å‡¦ç† ==========
  window.onload = function () {
    loadShopSettings();
    loadProducts();
    setupVoiceRecognition();
    checkInventoryAlerts(); // åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
    // å®šæœŸçš„ã«åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆ5åˆ†ã”ã¨ï¼‰
    setInterval(checkInventoryAlerts, 5 * 60 * 1000);
  };

  // åº—èˆ—è¨­å®šã‚’èª­ã¿è¾¼ã‚€
  function loadShopSettings() {
    google.script.run
      .withSuccessHandler(function (settings) {
        if (settings && settings.shop_name) {
          document.getElementById("shopName").textContent = settings.shop_name;
        }
      })
      .getShopSettings();
  }

  // Google Driveç”»åƒURLã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
  function formatGoogleDriveUrl(url) {
    if (!url || url.trim() === "") return "";

    try {
      url = url.trim();
      // Google Driveã®URLã‹ã©ã†ã‹ã‚’ç¢ºèª
      if (url.includes("drive.google.com")) {
        // æ§˜ã€…ãªGoogle Drive URLãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
        let fileId = null;

        if (url.includes("/file/d/")) {
          // é€šå¸¸ã®å…±æœ‰ãƒªãƒ³ã‚¯å½¢å¼
          fileId = url.match(/\/file\/d\/([-\w]{25,})/)?.[1];
        } else if (url.includes("id=")) {
          // id=ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢å¼
          fileId = url.match(/id=([-\w]{25,})/)?.[1];
        } else {
          // ãã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
          fileId = url.match(/[-\w]{25,}/)?.[0];
        }

        if (fileId) {
          // ç›´æ¥ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®URLã‚’ç”Ÿæˆ
          return "https://lh3.googleusercontent.com/d/" + fileId;
        }
      }

      // URLãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
      try {
        new URL(url);
        return url;
      } catch (e) {
        console.log("Invalid URL format:", url);
        return "";
      }
    } catch (e) {
      console.log("Error processing URL:", e);
      return "";
    }
  }

  // å•†å“ã‚’èª­ã¿è¾¼ã‚€
  function loadProducts() {
    google.script.run
      .withSuccessHandler(displayProducts)
      .withFailureHandler(showError)
      .getProductsWithStock();
  }

  // ========== å•†å“è¡¨ç¤ºé–¢é€£ ==========
  // å•†å“ã‚’è¡¨ç¤º
  function displayProducts(productData) {
    appState.products = productData;
    const grid = document.getElementById("productGrid");
    grid.innerHTML = "";

    appState.products.forEach((product) => {
      const tile = createProductTile(product);
      grid.appendChild(tile);
    });
  }

  // å•†å“ã‚¿ã‚¤ãƒ«ã‚’ä½œæˆ
  function createProductTile(product) {
    const tile = document.createElement("div");
    tile.className = "product-tile";

    const isOutOfStock = product["ç¾åœ¨åº«"] <= APP_CONFIG.STOCK.EMPTY;
    const isLowStock =
      product["ç¾åœ¨åº«"] > APP_CONFIG.STOCK.EMPTY &&
      product["ç¾åœ¨åº«"] <= APP_CONFIG.STOCK.LOW_THRESHOLD;

    if (isOutOfStock) {
      tile.className += " disabled";
    }

    tile.setAttribute("data-category", product["ã‚«ãƒ†ã‚´ãƒª"] || "");
    tile.innerHTML = createProductTileHTML(product, isLowStock);

    if (!isOutOfStock) {
      tile.onclick = () => handleProductClick(product);
    }

    return tile;
  }

  // å•†å“ã‚¿ã‚¤ãƒ«ã®HTMLã‚’ç”Ÿæˆ
  function createProductTileHTML(product, isLowStock) {
    const imageHtml = createProductImageHTML(product);
    const isOutOfStock = (product["ç¾åœ¨åº«"] || 0) <= APP_CONFIG.STOCK.EMPTY;
    const stockClass = isOutOfStock
      ? "stock-soldout"
      : isLowStock
        ? "low-stock"
        : "";
    const stockText = isOutOfStock
      ? "åœ¨åº«åˆ‡ã‚Œ"
      : (product["ç¾åœ¨åº«"] || 0) + "å€‹";
    const stockBadge = isOutOfStock
      ? '<div class="sold-out-badge">åœ¨åº«åˆ‡ã‚Œ</div>'
      : "";
    const stockLabel =
      !isOutOfStock && isLowStock
        ? '<br><span style="font-size: 0.65em;">æ®‹å°‘</span>'
        : "";

    return (
      stockBadge +
      imageHtml +
      '<div class="product-category">' +
      (product["ã‚«ãƒ†ã‚´ãƒª"] || "") +
      "</div>" +
      '<h3 style="margin: 0.5em 0; font-size: 1em;">' +
      (product["å•†å“å"] || "") +
      "</h3>" +
      '<div class="product-price">Â¥' +
      (product["ä¾¡æ ¼"] || 0).toLocaleString() +
      "</div>" +
      '<div class="product-stock ' +
      stockClass +
      '">' +
      stockText +
      stockLabel +
      "</div>"
    );
  }

  // å•†å“ç”»åƒã®HTMLã‚’ç”Ÿæˆ
  function createProductImageHTML(product) {
    const imageUrl = formatGoogleDriveUrl(product["ç”»åƒURL"]);
    const imageStyle =
      "height: " +
      APP_CONFIG.IMAGE.HEIGHT +
      "px; margin-bottom: 8px; border-radius: 4px;";

    if (imageUrl) {
      return (
        '<div class="product-image" style="' +
        imageStyle +
        ' overflow: hidden;">' +
        '<img src="' +
        imageUrl +
        '" alt="' +
        product["å•†å“å"] +
        '" ' +
        'style="width: 100%; height: 100%; object-fit: cover;" ' +
        'onerror="handleImageError(this)">' +
        "</div>"
      );
    } else {
      return createPlaceholderImage(imageStyle);
    }
  }

  // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã‚’ä½œæˆ
  function createPlaceholderImage(imageStyle) {
    return (
      '<div class="product-image" style="' +
      imageStyle +
      " background-color: " +
      APP_CONFIG.IMAGE.PLACEHOLDER_COLOR +
      "; " +
      'display: flex; align-items: center; justify-content: center;">' +
      '<span style="color: #999; font-size: ' +
      APP_CONFIG.IMAGE.ICON_SIZE +
      'px;">' +
      APP_CONFIG.IMAGE.DEFAULT_ICON +
      "</span>" +
      "</div>"
    );
  }

  // ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©
  function handleImageError(img) {
    const parent = img.parentElement;
    parent.innerHTML =
      '<span style="color: #999; font-size: ' +
      APP_CONFIG.IMAGE.ICON_SIZE +
      'px;">' +
      APP_CONFIG.IMAGE.DEFAULT_ICON +
      "</span>";
    parent.style.display = "flex";
    parent.style.alignItems = "center";
    parent.style.justifyContent = "center";
    parent.style.backgroundColor = APP_CONFIG.IMAGE.PLACEHOLDER_COLOR;
  }

  // å•†å“ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
  function handleProductClick(product) {
    const result = CartManager.add(product);
    if (!result.success) {
      alert(result.message);
    }
    updateCartDisplay();
  }

  // ã‚«ãƒ¼ãƒˆã«è¿½åŠ ï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
  function addToCart(product) {
    handleProductClick(product);
  }

  // ========== ã‚«ãƒ¼ãƒˆè¡¨ç¤ºé–¢é€£ ==========
  // ã‚«ãƒ¼ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
  function updateCartDisplay() {
    const elements = getCartElements();

    if (CartManager.isEmpty()) {
      displayEmptyCart(elements);
    } else {
      displayCartItems(elements);
    }
  }

  // ã‚«ãƒ¼ãƒˆé–¢é€£è¦ç´ ã‚’å–å¾—
  function getCartElements() {
    return {
      cartDiv: document.getElementById("cartItems"),
      totalDiv: document.getElementById("totalAmount"),
      cashButton: document.getElementById("cashButton"),
      qrButton: document.getElementById("qrButton"),
    };
  }

  // ç©ºã®ã‚«ãƒ¼ãƒˆã‚’è¡¨ç¤º
  function displayEmptyCart(elements) {
    elements.cartDiv.innerHTML = `
        <div class="cart-empty">
          <p>ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>
          <p style="font-size: 0.9em; margin-top: 10px;">å•†å“ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„</p>
        </div>
      `;
    elements.totalDiv.innerHTML = "åˆè¨ˆ: <span>Â¥0</span>";
    elements.cashButton.disabled = true;
    elements.qrButton.disabled = true;
  }

  // ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’è¡¨ç¤º
  function displayCartItems(elements) {
    elements.cashButton.disabled = false;
    elements.qrButton.disabled = false;
    elements.cartDiv.innerHTML = "";

    appState.cart.forEach((item, index) => {
      const itemDiv = createCartItemElement(item, index);
      elements.cartDiv.appendChild(itemDiv);
    });

    const total = CartManager.getTotal();
    elements.totalDiv.innerHTML = `åˆè¨ˆ: <span>Â¥${total.toLocaleString()}</span>`;
  }

  // ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ è¦ç´ ã‚’ä½œæˆ
  function createCartItemElement(item, index) {
    const itemDiv = document.createElement("div");
    itemDiv.className = "cart-item";

    const product = appState.products.find(
      (p) => p["å•†å“ID"] === item["å•†å“ID"],
    );
    const maxQuantity = product ? product["ç¾åœ¨åº«"] : item["æ•°é‡"];

    itemDiv.innerHTML = createCartItemHTML(item, index, maxQuantity);
    return itemDiv;
  }

  // ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®HTMLã‚’ç”Ÿæˆ
  function createCartItemHTML(item, index, maxQuantity) {
    return `
        <div class="cart-item-info">
          <div class="cart-item-name">${item["å•†å“å"]}</div>
          <div class="cart-item-quantity">Â¥${item["ä¾¡æ ¼"]} Ã— ${item["æ•°é‡"]}å€‹</div>
        </div>
        <div class="cart-item-actions">
          <div class="quantity-control">
            <button class="quantity-btn" onclick="updateQuantity(${index}, -1)" ${item["æ•°é‡"] <= 1 ? "disabled" : ""}>
              -
            </button>
            <span class="quantity-display">${item["æ•°é‡"]}</span>
            <button class="quantity-btn" onclick="updateQuantity(${index}, 1)" ${item["æ•°é‡"] >= maxQuantity ? "disabled" : ""}>
              +
            </button>
          </div>
          <button class="remove-btn" onclick="removeFromCart(${index})">å‰Šé™¤</button>
        </div>
        <div class="cart-item-price">Â¥${(item["ä¾¡æ ¼"] * item["æ•°é‡"]).toLocaleString()}</div>
      `;
  }

  // æ•°é‡ã‚’æ›´æ–°
  function updateQuantity(index, change) {
    if (CartManager.updateQuantity(index, change)) {
      updateCartDisplay();
    }
  }

  // ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
  function removeFromCart(index) {
    CartManager.remove(index);
    updateCartDisplay();
  }

  // ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
  function clearCart() {
    if (!CartManager.isEmpty() && confirm("ã‚«ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) {
      CartManager.clear();
      updateCartDisplay();
      // éŸ³å£°æ³¨æ–‡ã®ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
      document.getElementById("voiceStatus").textContent = "";
    }
  }

  // ========== æ±ºæ¸ˆå‡¦ç†é–¢é€£ ==========
  // æ±ºæ¸ˆå‡¦ç†
  function processPayment(method) {
    if (CartManager.isEmpty()) {
      alert("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™");
      return;
    }

    if (appState.isProcessing) {
      return; // äºŒé‡å‡¦ç†ã‚’é˜²ã
    }

    const total = CartManager.getTotal();

    if (method === APP_CONFIG.PAYMENT.METHODS.QR) {
      showQRPaymentModal(total);
    } else {
      showCashPaymentModal(total);
    }
  }

  // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  function showModal() {
    const modal = document.getElementById("customModal");
    modal.style.display = "flex";
  }

  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  function closeModal() {
    const modal = document.getElementById("customModal");
    modal.style.display = "none";
    appState.isProcessing = false;
  }

  // QRæ±ºæ¸ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  function showQRPaymentModal(total) {
    const modal = document.getElementById("customModal");
    const modalContent = document.getElementById("modalContent");

    modalContent.innerHTML = `
        <h2 style="margin-bottom: 20px;">QRæ±ºæ¸ˆ</h2>
        <p style="font-size: 1.2em; margin-bottom: 20px;">
          åˆè¨ˆé‡‘é¡: <strong style="color: #667eea;">Â¥${total.toLocaleString()}</strong>
        </p>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <p style="margin-bottom: 10px;">QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã—ã¦ãŠå®¢æ§˜ã«èª­ã¿å–ã£ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</p>
          <p style="color: #666; font-size: 0.9em;">â€»æ±ºæ¸ˆç¢ºèªå¾Œã«ã€Œæ±ºæ¸ˆå®Œäº†ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button onclick="completeQRPayment()" class="button button-primary">æ±ºæ¸ˆå®Œäº†</button>
          <button onclick="closeModal()" class="button button-danger">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      `;

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    modal.style.display = "flex";

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©
    window.closeModal = function () {
      modal.style.display = "none";
      appState.isProcessing = false;
    };

    window.completeQRPayment = function () {
      modal.style.display = "none";
      submitPayment(APP_CONFIG.PAYMENT.METHODS.QR);
    };

    appState.isProcessing = true;
  }

  // ç¾é‡‘æ±ºæ¸ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  function showCashPaymentModal(total) {
    const modal = document.getElementById("customModal");
    const modalContent = document.getElementById("modalContent");
    const defaultAmount =
      Math.ceil(total / APP_CONFIG.PAYMENT.CASH_ROUND_UNIT) *
      APP_CONFIG.PAYMENT.CASH_ROUND_UNIT;

    modalContent.innerHTML = createCashModalHTML(total, defaultAmount);

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    modal.style.display = "flex";

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©
    window.currentTotal = total;

    window.closeModal = function () {
      modal.style.display = "none";
      appState.isProcessing = false;
    };

    window.setQuickAmount = function (amount) {
      document.getElementById("receivedAmount").value = amount;
      calculateChange();
    };

    window.calculateChange = function () {
      const received =
        parseInt(document.getElementById("receivedAmount").value) || 0;
      const change = received - total;

      updateChangeDisplay(received, total, change);
    };

    window.completeCashPayment = function () {
      const received =
        parseInt(document.getElementById("receivedAmount").value) || 0;
      if (received < total) {
        alert("ãŠé ã‹ã‚Šé‡‘é¡ãŒä¸è¶³ã—ã¦ã„ã¾ã™");
        return;
      }

      modal.style.display = "none";
      submitPayment(APP_CONFIG.PAYMENT.METHODS.CASH);
    };

    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ä½¿ã£ã¦ã€DOMãŒæ›´æ–°ã•ã‚ŒãŸå¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    setTimeout(() => {
      const input = document.getElementById("receivedAmount");
      if (input) {
        input.addEventListener("input", calculateChange);
        input.focus();
        input.select();
        // åˆæœŸè¨ˆç®—
        calculateChange();
      }
    }, 100);

    appState.isProcessing = true;
  }

  // ç¾é‡‘ãƒ¢ãƒ¼ãƒ€ãƒ«ã®HTMLç”Ÿæˆ
  function createCashModalHTML(total, defaultAmount) {
    const quickAmounts = [1000, 2000, 3000, 5000, 10000];
    const quickButtonsHTML = quickAmounts
      .map(
        (amount) =>
          `<button class="quick-amount-btn" onclick="setQuickAmount(${amount})" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white; cursor: pointer;">Â¥${amount.toLocaleString()}</button>`,
      )
      .join("");

    return `
        <h2 style="margin-bottom: 20px;">ğŸ’´ ç¾é‡‘æ±ºæ¸ˆ</h2>
        <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p style="font-size: 1.3em; margin: 0;">åˆè¨ˆé‡‘é¡</p>
          <p style="font-size: 2em; font-weight: bold; color: #667eea; margin: 5px 0;">Â¥${total.toLocaleString()}</p>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 10px; font-weight: bold;">ãŠé ã‹ã‚Šé‡‘é¡</label>
          <input type="number" id="receivedAmount" style="width: 100%; padding: 15px; font-size: 1.5em; text-align: center; border: 2px solid #ddd; border-radius: 8px;" 
                 placeholder="0" min="${total}" step="100" value="${defaultAmount}">
        </div>
        
        <div id="changeDisplay" style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
          <p style="font-size: 1.1em; margin: 0;">ãŠã¤ã‚Š</p>
          <p id="changeAmount" style="font-size: 2em; font-weight: bold; color: #4caf50; margin: 5px 0;">Â¥0</p>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button id="confirmCashBtn" onclick="completeCashPayment()" class="button button-primary" style="flex: 1;">æ±ºæ¸ˆç¢ºå®š</button>
          <button onclick="closeModal()" class="button button-secondary" style="flex: 1;">ã‚«ãƒ¼ãƒˆã«æˆ»ã‚‹</button>
        </div>
        
        <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
          ${quickButtonsHTML}
          <button class="quick-amount-btn" onclick="setQuickAmount(${total})" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white; cursor: pointer;">ã¡ã‚‡ã†ã©</button>
        </div>
      `;
  }

  // ãŠã¤ã‚Šè¡¨ç¤ºã‚’æ›´æ–°
  function updateChangeDisplay(received, total, change) {
    const changeDisplay = document.getElementById("changeDisplay");
    const changeAmount = document.getElementById("changeAmount");
    const confirmBtn = document.getElementById("confirmCashBtn");

    if (received >= total) {
      changeDisplay.style.display = "block";
      changeAmount.textContent = "Â¥" + change.toLocaleString();
      confirmBtn.disabled = false;
      confirmBtn.style.opacity = "1";
    } else {
      changeDisplay.style.display = "none";
      confirmBtn.disabled = true;
      confirmBtn.style.opacity = "0.5";
    }
  }

  // æ±ºæ¸ˆã‚’é€ä¿¡
  function submitPayment(method) {
    // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    document.getElementById("cashButton").disabled = true;
    document.getElementById("qrButton").disabled = true;

    google.script.run
      .withSuccessHandler(paymentSuccess)
      .withFailureHandler(paymentError)
      .processTransaction(appState.cart, method);
  }

  // æ±ºæ¸ˆæˆåŠŸ
  function paymentSuccess(result) {
    // resultã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ {success: true, transactionId: "...", total: ...}
    const transactionId = result.transactionId || result;
    const total = result.total || CartManager.getTotal();

    // ã‚«ã‚¹ã‚¿ãƒ æˆåŠŸãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    showSuccessModal(transactionId, total);
    resetAfterPayment();
  }

  // æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼
  function paymentError(error) {
    console.error("Payment error:", error);
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
    enablePaymentButtons();
    appState.isProcessing = false;
  }

  // æˆåŠŸãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  function showSuccessModal(transactionId, total) {
    const modal = document.getElementById("customModal");
    const modalContent = document.getElementById("modalContent");

    const successHtml = `
        <div style="text-align: center; padding: 20px;">
          <div style="font-size: 72px; margin-bottom: 20px;">âœ…</div>
          <h2 style="color: #2ecc71; margin-bottom: 20px;">æ±ºæ¸ˆå®Œäº†ï¼</h2>
          
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin: 20px 0;">
            <div style="margin-bottom: 15px;">
              <div style="font-size: 14px; color: #666;">å–å¼•ID</div>
              <div style="font-size: 18px; font-weight: bold; color: #333; word-break: break-all;">
                ${transactionId}
              </div>
            </div>
            
            <div style="margin-bottom: 15px;">
              <div style="font-size: 14px; color: #666;">åˆè¨ˆé‡‘é¡</div>
              <div style="font-size: 24px; font-weight: bold; color: #333;">
                Â¥${total.toLocaleString()}
              </div>
            </div>
            
            <div style="margin-top: 20px;">
              <div style="font-size: 16px; color: #666;">
                ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
              </div>
            </div>
          </div>
          
          <button onclick="closeSuccessModal()" style="
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
          ">
            OK
          </button>
        </div>
      `;

    modalContent.innerHTML = successHtml;
    modal.style.display = "block";

    // 3ç§’å¾Œã«è‡ªå‹•çš„ã«é–‰ã˜ã‚‹
    setTimeout(() => {
      closeSuccessModal();
    }, 3000);
  }

  // æˆåŠŸãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  function closeSuccessModal() {
    closeModal();
    enablePaymentButtons();
  }

  // æ±ºæ¸ˆå¾Œã®ãƒªã‚»ãƒƒãƒˆ
  function resetAfterPayment() {
    CartManager.clear();
    updateCartDisplay();
    loadProducts();
    clearVoiceStatus();
    appState.isProcessing = false;
  }

  // æ±ºæ¸ˆãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
  function enablePaymentButtons() {
    document.getElementById("cashButton").disabled = false;
    document.getElementById("qrButton").disabled = false;
  }

  // éŸ³å£°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚¯ãƒªã‚¢
  function clearVoiceStatus() {
    document.getElementById("voiceStatus").textContent = "";
  }

  // ========== ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ==========
  // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
  function showError(error) {
    console.error("Error:", error);
    const grid = document.getElementById("productGrid");
    grid.innerHTML = createErrorHTML(error.message);
  }

  // ã‚¨ãƒ©ãƒ¼HTMLã‚’ç”Ÿæˆ
  function createErrorHTML(message) {
    return `
        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
          <p>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>
          <p style="font-size: 0.9em; margin-top: 10px;">${message}</p>
          <button class="button button-primary" onclick="loadProducts()" style="margin-top: 20px;">
            å†èª­ã¿è¾¼ã¿
          </button>
        </div>
      `;
  }

  // ========== éŸ³å£°èªè­˜é–¢é€£ ==========
  const VoiceRecognition = {
    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒƒãƒ—
    ERROR_MESSAGES: {
      "no-speech": "éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ",
      "audio-capture": "ãƒã‚¤ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
      "not-allowed": "ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ",
      network: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
    },

    // éŸ³å£°èªè­˜ã®è¨­å®š
    setup: function () {
      if (!this.isSupported()) {
        this.handleNotSupported();
        return;
      }

      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      appState.recognition = new SpeechRecognition();

      this.configureRecognition();
      this.setupEventHandlers();

      document.getElementById("voiceButton").onclick = () => this.start();
    },

    // ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
    isSupported: function () {
      return (
        "webkitSpeechRecognition" in window || "SpeechRecognition" in window
      );
    },

    // éå¯¾å¿œæ™‚ã®å‡¦ç†
    handleNotSupported: function () {
      document.getElementById("voiceButton").style.display = "none";
      this.updateStatus("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“", "#999");
    },

    // èªè­˜è¨­å®š
    configureRecognition: function () {
      const recognition = appState.recognition;
      recognition.lang = "ja-JP";
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
    },

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©è¨­å®š
    setupEventHandlers: function () {
      const recognition = appState.recognition;

      recognition.onstart = () => this.onStart();
      recognition.onresult = (event) => this.onResult(event);
      recognition.onend = () => this.onEnd();
      recognition.onerror = (event) => this.onError(event);
    },

    // éŸ³å£°èªè­˜é–‹å§‹
    start: function () {
      if (appState.recognition) {
        try {
          appState.recognition.start();
        } catch (e) {
          console.error("Recognition start error:", e);
          this.updateStatus(
            "éŸ³å£°èªè­˜ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸ",
            APP_CONFIG.UI.ERROR_COLOR,
          );
        }
      }
    },

    // èªè­˜é–‹å§‹æ™‚
    onStart: function () {
      this.updateButton(
        "ğŸ”´ èã„ã¦ã„ã¾ã™...",
        "linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",
      );
      this.updateStatus("è©±ã—ã¦ãã ã•ã„", "#2196F3");
    },

    // èªè­˜çµæœ
    onResult: function (event) {
      const transcript = event.results[0][0].transcript;
      this.updateStatus("èªè­˜çµæœ: " + transcript, APP_CONFIG.UI.SUCCESS_COLOR);

      google.script.run
        .withSuccessHandler(handleVoiceOrderResult)
        .withFailureHandler(handleVoiceOrderError)
        .processVoiceOrder(transcript);
    },

    // èªè­˜çµ‚äº†æ™‚
    onEnd: function () {
      this.resetButton();
    },

    // ã‚¨ãƒ©ãƒ¼æ™‚
    onError: function (event) {
      console.error("Speech recognition error:", event.error);
      const errorMessage =
        this.ERROR_MESSAGES[event.error] || "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
      this.updateStatus(errorMessage, APP_CONFIG.UI.ERROR_COLOR);
      this.resetButton();
    },

    // ãƒœã‚¿ãƒ³æ›´æ–°
    updateButton: function (text, background) {
      const button = document.getElementById("voiceButton");
      button.innerHTML = text;
      button.style.background = background;
    },

    // ãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
    resetButton: function () {
      this.updateButton(
        "ğŸ¤ éŸ³å£°ã§æ³¨æ–‡",
        "linear-gradient(135deg, #2196F3 0%, #1976D2 100%)",
      );
    },

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    updateStatus: function (message, color) {
      const status = document.getElementById("voiceStatus");
      status.textContent = message;
      status.style.color = color;
    },
  };

  // éŸ³å£°èªè­˜ã®è¨­å®šï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
  function setupVoiceRecognition() {
    VoiceRecognition.setup();
  }

  // éŸ³å£°æ³¨æ–‡ã®çµæœã‚’å‡¦ç†
  function handleVoiceOrderResult(result) {
    if (result.success && result.items && result.items.length > 0) {
      processVoiceOrderItems(result.items);
      VoiceRecognition.updateStatus(
        result.message,
        APP_CONFIG.UI.SUCCESS_COLOR,
      );
    } else {
      VoiceRecognition.updateStatus(
        result.message || "å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ",
        APP_CONFIG.UI.WARNING_COLOR,
      );
    }
  }

  // éŸ³å£°æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‡¦ç†
  function processVoiceOrderItems(items) {
    items.forEach((item) => {
      const product = appState.products.find(
        (p) => p["å•†å“ID"] === item["å•†å“ID"],
      );
      if (product) {
        addVoiceOrderItem(product, item["æ•°é‡"]);
      }
    });
    updateCartDisplay();
  }

  // éŸ³å£°æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
  function addVoiceOrderItem(product, quantity) {
    const existingItem = appState.cart.find(
      (item) => item["å•†å“ID"] === product["å•†å“ID"],
    );

    if (existingItem) {
      const newQuantity = existingItem["æ•°é‡"] + quantity;
      if (newQuantity <= product["ç¾åœ¨åº«"]) {
        existingItem["æ•°é‡"] = newQuantity;
      } else {
        showStockWarning(product["å•†å“å"], product["ç¾åœ¨åº«"]);
      }
    } else {
      if (quantity <= product["ç¾åœ¨åº«"]) {
        appState.cart.push({
          ...product,
          æ•°é‡: quantity,
        });
      } else {
        showStockWarning(product["å•†å“å"], product["ç¾åœ¨åº«"]);
      }
    }
  }

  // åœ¨åº«ä¸è¶³è­¦å‘Šã‚’è¡¨ç¤º
  function showStockWarning(productName, stock) {
    alert(`${productName}ã®åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆæ®‹ã‚Š${stock}å€‹ï¼‰`);
  }

  // éŸ³å£°æ³¨æ–‡ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
  function handleVoiceOrderError(error) {
    console.error("Voice order error:", error);
    VoiceRecognition.updateStatus(
      "ã‚¨ãƒ©ãƒ¼: " + error.message,
      APP_CONFIG.UI.ERROR_COLOR,
    );
  }

  // ========== åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ ==========

  // åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
  function checkInventoryAlerts() {
    google.script.run
      .withSuccessHandler(displayAlerts)
      .withFailureHandler((error) => console.error("Alert check error:", error))
      .getInventoryAlerts();
  }

  // ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤º
  function displayAlerts(alerts) {
    const alertBar = document.getElementById("alertBar");
    const alertSummary = document.getElementById("alertSummary");

    if (!alerts || alerts.length === 0) {
      alertBar.style.display = "none";
      return;
    }

    // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«åˆ¥ã«ã‚«ã‚¦ãƒ³ãƒˆ
    const criticalCount = alerts.filter(
      (a) => a.level === "critical" || a.level === "sold_out",
    ).length;
    const warningCount = alerts.filter((a) => a.level === "warning").length;

    // ã‚µãƒãƒªãƒ¼ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ
    const summaryParts = [];
    if (criticalCount > 0) {
      summaryParts.push(`å±é™º: ${criticalCount}ä»¶`);
    }
    if (warningCount > 0) {
      summaryParts.push(`æ³¨æ„: ${warningCount}ä»¶`);
    }

    alertSummary.textContent = summaryParts.join(" / ");

    // ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´
    if (criticalCount > 0) {
      alertBar.style.background = "#f8d7da";
      alertBar.style.borderColor = "#dc3545";
    } else {
      alertBar.style.background = "#fff3cd";
      alertBar.style.borderColor = "#ffc107";
    }

    alertBar.style.display = "block";

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜ï¼ˆè©³ç´°è¡¨ç¤ºç”¨ï¼‰
    window.currentAlerts = alerts;
  }

  // ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°ã‚’è¡¨ç¤º
  function showAlertDetails() {
    if (!window.currentAlerts || window.currentAlerts.length === 0) {
      return;
    }

    const modal = document.getElementById("customModal");
    const modalContent = document.getElementById("modalContent");

    // ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°ã®HTMLä½œæˆ
    let detailsHtml = `
        <div style="padding: 10px;">
          <h2 style="margin-bottom: 20px;">ğŸ“¦ åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆè©³ç´°</h2>
          <div style="max-height: 400px; overflow-y: auto;">
      `;

    // å£²ã‚Šåˆ‡ã‚Œãƒ»å±é™ºåœ¨åº«ã‚’å…ˆã«è¡¨ç¤º
    const sortedAlerts = [...window.currentAlerts].sort((a, b) => {
      const levelOrder = { sold_out: 0, critical: 1, warning: 2 };
      return (levelOrder[a.level] || 3) - (levelOrder[b.level] || 3);
    });

    sortedAlerts.forEach((alert) => {
      const levelColor =
        {
          sold_out: "#dc3545",
          critical: "#fd7e14",
          warning: "#ffc107",
        }[alert.level] || "#6c757d";

      const levelText =
        {
          sold_out: "å£²ã‚Šåˆ‡ã‚Œ",
          critical: "å±é™º",
          warning: "æ³¨æ„",
        }[alert.level] || "æƒ…å ±";

      detailsHtml += `
          <div style="border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
              <div>
                <h4 style="margin: 0 0 10px 0;">
                  ${alert.productName}
                  <span style="background: ${levelColor}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px;">
                    ${levelText}
                  </span>
                </h4>
                <div style="color: #666; font-size: 0.9em;">
                  <div>ç¾åœ¨åº«: <strong>${alert.currentStock}å€‹</strong></div>
                  <div>å£²ä¸Šé€Ÿåº¦: ${alert.salesRate}å€‹/æ™‚é–“</div>
                  ${alert.timeToSoldOut ? `<div>å£²ã‚Šåˆ‡ã‚Œäºˆæ¸¬: <strong style="color: ${levelColor};">${alert.timeToSoldOut}</strong></div>` : ""}
                  ${alert.reorderQuantity > 0 ? `<div>æ¨å¥¨ç™ºæ³¨æ•°: ${alert.reorderQuantity}å€‹</div>` : ""}
                </div>
              </div>
            </div>
          </div>
        `;
    });

    detailsHtml += `
          </div>
          <div style="margin-top: 20px; text-align: center;">
            <button onclick="showReorderList()" class="button button-primary" style="margin-right: 10px;">
              ğŸ“‹ ç™ºæ³¨ãƒªã‚¹ãƒˆä½œæˆ
            </button>
            <button onclick="closeModal()" class="button button-secondary">
              é–‰ã˜ã‚‹
            </button>
          </div>
        </div>
      `;

    modalContent.innerHTML = detailsHtml;
    modal.style.display = "flex";
  }

  // ç™ºæ³¨ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
  function showReorderList() {
    google.script.run
      .withSuccessHandler(displayReorderList)
      .withFailureHandler((error) =>
        console.error("Reorder list error:", error),
      )
      .getReorderList();
  }

  // ç™ºæ³¨ãƒªã‚¹ãƒˆã®è¡¨ç¤º
  function displayReorderList(reorderList) {
    const modal = document.getElementById("customModal");
    const modalContent = document.getElementById("modalContent");

    if (!reorderList || reorderList.length === 0) {
      modalContent.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">âœ…</div>
            <h3>ç™ºæ³¨ã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“</h3>
            <p style="color: #666; margin-top: 10px;">åœ¨åº«ã¯é©åˆ‡ãªãƒ¬ãƒ™ãƒ«ã§ã™</p>
            <button onclick="closeModal()" class="button button-primary" style="margin-top: 20px;">
              OK
            </button>
          </div>
        `;
      return;
    }

    let listHtml = `
        <div style="padding: 10px;">
          <h2 style="margin-bottom: 20px;">ğŸ“‹ è‡ªå‹•ç™ºæ³¨ãƒªã‚¹ãƒˆ</h2>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="border-bottom: 2px solid #dee2e6;">
                  <th style="text-align: left; padding: 10px;">å•†å“å</th>
                  <th style="text-align: center; padding: 10px;">ç¾åœ¨åº«</th>
                  <th style="text-align: center; padding: 10px;">æ¨å¥¨æ•°</th>
                  <th style="text-align: center; padding: 10px;">ç·Šæ€¥åº¦</th>
                </tr>
              </thead>
              <tbody>
      `;

    reorderList.forEach((item) => {
      const urgencyColor = item.urgency === "ç·Šæ€¥" ? "#dc3545" : "#fd7e14";
      listHtml += `
          <tr style="border-bottom: 1px solid #dee2e6;">
            <td style="padding: 10px;">${item.productName}</td>
            <td style="text-align: center; padding: 10px;">${item.currentStock}å€‹</td>
            <td style="text-align: center; padding: 10px;"><strong>${item.recommendedQuantity}å€‹</strong></td>
            <td style="text-align: center; padding: 10px;">
              <span style="color: ${urgencyColor}; font-weight: bold;">${item.urgency}</span>
            </td>
          </tr>
        `;
    });

    listHtml += `
              </tbody>
            </table>
          </div>
          <div style="text-align: center;">
            <button onclick="copyReorderList()" class="button button-primary" style="margin-right: 10px;">
              ğŸ“‹ ãƒªã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
            </button>
            <button onclick="closeModal()" class="button button-secondary">
              é–‰ã˜ã‚‹
            </button>
          </div>
        </div>
      `;

    modalContent.innerHTML = listHtml;

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰
    window.currentReorderList = reorderList;
  }

  // ç™ºæ³¨ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
  function copyReorderList() {
    if (!window.currentReorderList) return;

    let text = "ã€ç™ºæ³¨ãƒªã‚¹ãƒˆã€‘\n\n";
    window.currentReorderList.forEach((item) => {
      text += `${item.productName}: ${item.recommendedQuantity}å€‹ (ç¾åœ¨åº«: ${item.currentStock}å€‹) [${item.urgency}]\n`;
    });

    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
    navigator.clipboard
      .writeText(text)
      .then(() => {
        alert("ç™ºæ³¨ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
      })
      .catch((err) => {
        console.error("Copy failed:", err);
        alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
      });
  }
</script>
