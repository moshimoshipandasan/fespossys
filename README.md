## 利用マニュアル

### 1. テンプレートをコピーする
- テンプレート用スプレッドシートを開きます: <https://docs.google.com/spreadsheets/d/1uV9rM0tl7rWimjAZThQIgJ1J7DdlsTZTFXPMUph4XOQ/copy>
- 「コピーを作成」をクリックし、任意のドライブフォルダに保存します。
- 運用メンバーが共同編集できるように、必要に応じて共有設定を行います。

### 2. Apps Script プロジェクトを確認する
- コピーしたスプレッドシートで `拡張機能 > Apps Script` を開き、プロジェクトが複製されていることを確認します。
- `.clasp.json` が指す Apps Script プロジェクトと一致している場合はそのまま利用できます。別環境で実行する場合は `clasp clone` でローカル環境も合わせておきます。

### 3. スプレッドシートを初期化する
1. スプレッドシートを開くとメニューに `🎪 POSシステム設定` が追加されます。
2. `🎪 POSシステム設定 > 📋 初期設定（シート作成）` を実行します。
3. 「商品マスタ」「在庫管理」「販売履歴」「設定」「ダッシュボード」など必要なタブが自動生成されます。
4. テスト確認を行う場合は `🎪 POSシステム設定 > 🎯 ダミーデータ生成（テスト用）` を実行し、サンプル商品・販売履歴を投入します（本番運用前に削除してください）。

### 4. 各タブの整備
- **設定** タブ: `shop_name`, `qr_payment_name`, `sales_target`, `opening_time` などのキーを編集し、店舗情報・営業時間・売上目標を入力します。
- **商品マスタ** タブ: 商品ID・名称・価格・カテゴリ・初期在庫などを登録します。行の追加／削除で品目を調整できます。
- **在庫管理** タブ: 初期設定で商品マスタから自動作成されます。現在庫列を実在庫に合わせて更新し、必要に応じて `在庫準備：初期在庫へ補充` を利用してリセットします。
- **ダッシュボード** タブ: 自動生成される KPI 表示用タブです。後述の `ダッシュボード更新` やトリガーで数値が更新されます。

### 5. Web アプリをデプロイして紐づける
1. Apps Script 画面で `デプロイ > 新しいデプロイ` を選択します。
2. 種類を「ウェブアプリ」に設定し、説明を入力します。
3. 「実行するアプリ」を `自分`、アクセス権を `全員（匿名含む）` または利用想定に合わせて設定しデプロイします。
4. 表示された URL をコピーし、スプレッドシートに戻って `🎪 POSシステム設定 > 🌐 WebアプリURL設定` を実行して保存します。
5. `🎪 POSシステム設定 > 🚀 Webアプリを開く` で POS 画面が新しいタブに開くことを確認します。

### 6. Gemini API キーを設定する（任意）
- 音声注文解析や AI 補助機能を使う場合は <https://makersuite.google.com/app/apikey> で API キーを取得します。
- `🎪 POSシステム設定 > 🔑 Gemini APIキー設定` を実行し、取得したキーを入力します（キーはスクリプトプロパティに保存されます）。

### 7. メニュー機能の概要
- **🗓 日次作業**: 日次売上集計（本日／任意日）、販売履歴のアーカイブ、初期在庫補充、PDF 出力、締め処理（集計+アーカイブ+補充）をまとめて実行できます。
- **📅 月次・分析**: 今月の月次サマリー生成、全期間再集計、カテゴリ別月次分析を実行し、サマリータブを自動作成します。
- **📦 在庫管理**: 在庫アラートの即時チェックと、推奨発注数を含む発注リストの新規シート作成が行えます。
- **📚 ドキュメント**: HTML サイドバーで開発マニュアルやカリキュラムを参照できます。
- その他: `ダッシュボード更新`、`トリガー設定`（5分毎にダッシュボード更新）、`データ全削除`（取り消し不可のため慎重に実行）などのユーティリティがあります。

### 8. Web アプリ（POS 画面）の使い方
1. `🎪 POSシステム設定 > 🚀 Webアプリを開く` またはデプロイ時に取得した URL から POS 画面を表示します。
2. 商品タイルをタップしてカートへ追加し、右下の合計を確認します。`カートをクリア` で一括削除が可能です。
3. `💴 現金決済` または `📱 QR決済` ボタンで決済処理を実行すると、`販売履歴` にトランザクションが記録され、`在庫管理` が減算されます。
4. `🎤 音声で注文` ボタンを押下すると Gemini が音声入力を解析し、候補商品をカートに提案します（API キー設定が必要）。
5. 在庫が閾値を下回るとアラートバーが表示され、`詳細を見る` から不足商品を確認できます。

### 9. 日次オペレーションの推奨フロー
- **開店準備**: `在庫アラートチェック`→`在庫準備：初期在庫へ補充`→`ダッシュボード更新` で状態を揃えます。
- **営業中**: POS 画面で販売登録を続けながら、必要に応じて `発注リスト生成` を実行し補充計画を立てます。
- **締め作業**: `📊+🗃+🔁 締め処理（集計+アーカイブ+在庫準備）` を実行すると、日次レポートの作成・販売履歴のアーカイブ・在庫リセットまでを一括で完了できます。個別に操作したい場合は各メニューを単独で実行してください。

### 10. 月次・分析レポート
- 月末やイベント後に `📅 月次サマリー（今月）` を実行すると、期間中の売上指標がまとめられたタブが生成されます。
- `📊 カテゴリ別月次（全期間）` でカテゴリごとの傾向を確認し、来期の品揃え計画に活用できます。

### 11. トリガーと自動更新
- `🎪 POSシステム設定 > ⚙️ トリガー設定` で既存トリガーを整理した上で 5 分毎のダッシュボード更新トリガーを再作成します。Apps Script の「トリガー」画面で実行アカウントに権限があるか確認してください。
- 自動更新が止まった場合は、トリガー一覧でエラー有無を確認し、必要に応じてメニューから再設定します。

### 12. トラブルシューティング
- **Web アプリが開かない**: 一度 `🌐 WebアプリURL設定` を再入力し、デプロイ URL が有効か確認します。アクセス権が制限されている場合は共有設定を見直してください。
- **Gemini 連携が動作しない**: API キーが有効期限切れでないかを確認し、`🔑 Gemini APIキー設定` から再登録します。
- **データを初期化したい**: `🗑️ データ全削除（注意）` は全タブのデータを消去します。手順を誤ると復旧できないため、実行前にバックアップを取得してください。

## Contributing
- プルリクエスト歓迎です。規模が大きい変更は事前に Issue で相談してください。
- `clasp pull` で最新状態を取り込み、`clasp run initializeSpreadsheet` などの手動テストを実施してから提出してください。
- `AGENTS.md` のレビュー手順・コミット規約・手動テスト記録フォーマットに従ってください。

## 公開前チェックリスト
- `.clasp.json` に本番と異なる `scriptId` や個人アカウント情報が含まれていないことを確認する。
- スプレッドシート／Apps Script プロパティに保存した API キーやシークレットを削除またはマスクする。
- `README.md`・`manual.html`・`curriculum.html` の手順が現行仕様と一致しているか再確認する。
- 依存する外部サービスの利用規約（Gemini API など）と学校の情報セキュリティ指針に適合していることを確認する。

## License
This project is licensed under the MIT License. See `LICENSE` for full text.
